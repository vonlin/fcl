<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="../../../stylesheets/style.css" rel="stylesheet" type="text/css">
    <script src="../../jslib/require.js" type="text/javascript" data-main="../../js/config.js" data-js="demo.js" id="require"></script>
</head>
<body draggable="true" id="drop">
<section style="margin-bottom:20px;">
    <label>编码：</label><input id="code" fcl-model="code"/>
    <label>名称：</label><input id="name" fcl-model="name"/>
    <label>年：</label><input id="year" fcl-model="year"/>
    <label>月：</label><input id="month" fcl-model="month"/>
    <label>文件名：</label><input id="filename" fcl-model="filename"/>
    <input type="button" value="增加" fcl-event="click!add"/>
</section>

<div id="update" class="g-hide">
    <div style="width:100%;height:100%;background:black;opacity:.3;position:absolute;top:0;left:0"></div>
    <div style="width:90%;height:100px;position:absolute;background:white;padding-top:45px;padding-left:50px;">
        <section>
            <label>ID：</label><input id="_id" fcl-data="m._id" fcl-model="_id"/>
            <label>编码：</label><input id="codeu" fcl-data="m.codeu" fcl-model="codeu"/>
            <label>名称：</label><input id="nameu" fcl-data="m.a.c.d.mangerName|filterFn" fcl-model="nameu"/>
            <label>年：</label><input id="yearu" fcl-data="m._id" fcl-model="_id"/>
            <label>月：</label><input id="monthu" fcl-data="m._id" fcl-model="_id"/>
            <label>文件名：</label><input id="filenameu" fcl-data="m._id" fcl-model="_id"/>
            <input type="button" value="提交修改" fcl-event="click!submitUpdate"/>
        </section>
    </div>
</div>

<div style="width: 1400px;height:800px;" id="gridDemo" class="g-hide"></div>
<div style="width:200px;height:200px;background-color:#ddd;display: inline-block;" draggable="true" id="drag"></div>

<!--<div style="width:200px;height:200px;background-color:#f0f0f0;display: inline-block;margin-left: 400px;" draggable="true"></div>-->
<!--<input fcl-model="count"/>-->
<!--<input fcl-model="count"/>-->
<!--<button fcl-control="click!addcount">click</button>-->
<!--<button fcl-control="click!addcount">click2</button>-->
</body>
<script type="text/javascript">
    var drag = document.getElementById("drag");
    var drop = document.getElementById("drop");
    var flag = true;

    drag.ondragstart = function(e){
        console.info("dragstart");
        e.dataTransfer.setData("Text", e.target.id);
    };

//    window.draggable = true;
    window.ondragover = function(e){
//        console.info(e.dataTransfer);
        e.preventDefault();
    };
    window.ondrop = function(e){
        var elid = e.dataTransfer.getData("Text");
        var el = document.getElementById(elid);
        el.style.position = "absolute";
        el.style.left = getCurPos(e).x - parseInt(el.style.width.replace("px",""))/2+"px";
        el.style.top = getCurPos(e).y- parseInt(el.style.height.replace("px",""))/2+"px" ;
        e.target.appendChild(el);
    };
    drop.ondragenter = function(){
        console.info("dragenter");
    };
    drag.ondragend = function(){
        console.info("dragend");
    };




//    dragO.addEventListener("mousedown",function(){
//        flag = true;
//        document.onmouseup = function(){
//            flag = false;
//        };
//        document.onmousemove = function(e){
//           if(flag){
//               dragO.style.position = "absolute";
//               dragO.style.left = getCurPos(e).x - parseInt(dragO.style.width.replace("px",""))/2+"px";
//               dragO.style.top = getCurPos(e).y- parseInt(dragO.style.height.replace("px",""))/2+"px" ;
////               console.info(getCurPos(e));
//               console.info(getObjPos(dragO));
//           }
//        };
//
//
//    },false);
//
    function getCurPos(e){
        e = e || window.event;
        var D = document.documentElement;
        if (e.pageX) return {x: e.pageX, y: e.pageY};
        return {
            x: e.clientX + D.scrollLeft - D.clientLeft,
            y: e.clientY + D.scrollTop - D.clientTop
        };
    }
    function getObjPos(obj)
    {
        var x = y = 0;
        if (obj.getBoundingClientRect)
        {
            var box = obj.getBoundingClientRect();
            var D = document.documentElement;
            x = box.left + Math.max(D.scrollLeft, document.body.scrollLeft) - D.clientLeft;
            y = box.top + Math.max(D.scrollTop, document.body.scrollTop) - D.clientTop;
        }
        else
        {
            for(; obj != document.body; x += obj.offsetLeft, y += obj.offsetTop, obj = obj.offsetParent );
        }
        return {'x':x, 'y':y};
    }
</script>
</html>